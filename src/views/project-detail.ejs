<h1><%= project.name %></h1>
<p><%= project.description || '' %></p>

<div style="margin: 1rem 0;">
  <a class="btn-outline" href="/projects">← Back to Projects</a>
  <a class="btn" style="margin-left:.5rem;" href="/reports/discovery/run/<%= project.id %>">Run Discovery Pulse</a>
</div>

<hr/>

<!-- Scheduling block if you added scheduling -->
<div class="card" style="margin:.5rem 0 1rem;">
  <strong>Scheduling</strong>
  <form method="post" action="/projects/<%= project.id %>/schedule/weekly" style="display:flex; gap:.5rem; align-items:center; margin-top:.5rem;">
    <span>Weekly (Mon):</span>
    <input type="number" name="hour" min="0" max="23" value="9" style="width:70px; padding:.3rem; border:1px solid #ccc; border-radius:8px;">
    <input type="number" name="minute" min="0" max="59" value="0" style="width:70px; padding:.3rem; border:1px solid #ccc; border-radius:8px;">
    <button class="btn">Enable</button>
  </form>
  <form method="post" action="/projects/<%= project.id %>/schedule/monthly" style="display:flex; gap:.5rem; align-items:center; margin-top:.5rem;">
    <span>Monthly (day):</span>
    <input type="number" name="day" min="1" max="28" value="1" style="width:70px; padding:.3rem; border:1px solid #ccc; border-radius:8px;">
    <input type="number" name="hour" min="0" max="23" value="9" style="width:70px; padding:.3rem; border:1px solid #ccc; border-radius:8px;">
    <input type="number" name="minute" min="0" max="59" value="0" style="width:70px; padding:.3rem; border:1px solid #ccc; border-radius:8px;">
    <button class="btn">Enable</button>
  </form>
  <form method="post" action="/projects/<%= project.id %>/schedule/disable" style="margin-top:.5rem;">
    <button class="btn-outline">Disable all</button>
  </form>
</div>

<hr/>

<h2>Insights</h2>
<form method="post" action="/projects/<%= project.id %>/insights" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
  <div style="display:flex; gap:.5rem;">
    <input name="title" placeholder="Insight title" required style="flex:2; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <input name="summary" placeholder="Summary" style="flex:3; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  </div>
  <div style="display:flex; gap:.5rem;">
    <input type="number" step="1" min="0" max="10" name="impactScore" value="5" style="width:120px; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <select name="confidence" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option>LOW</option><option selected>MEDIUM</option><option>HIGH</option>
    </select>
    <button class="btn">Add Insight</button>
  </div>
</form>

<ul style="list-style:none; padding:0;">
  <% project.insights.forEach(i => { %>
    <li class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong><%= i.title %></strong>
          <div><small>Impact: <%= i.impactScore %> • Confidence: <%= i.confidence %></small></div>
          <div><%= i.summary %></div>
        </div>
        <div>
          <a class="btn-outline" href="/projects/<%= project.id %>/insights/<%= i.id %>/edit">Edit</a>
          <form method="post" action="/projects/<%= project.id %>/insights/<%= i.id %>/delete" style="display:inline;">
            <button class="btn" style="margin-left:.5rem; background:#b91c1c;">Delete</button>
          </form>
        </div>
      </div>
    </li>
  <% }) %>
</ul>

<hr/>

<h2>Outcomes</h2>
<form method="post" action="/projects/<%= project.id %>/outcomes" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
  <input name="title" placeholder="Outcome title" required style="padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  <textarea name="description" rows="2" placeholder="Description" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;"></textarea>
  <div style="display:flex; gap:.5rem;">
    <input type="number" step="0.01" name="targetValue" placeholder="Target value (optional)" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <select name="metricId" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option value="">Link metric (optional)</option>
      <% metrics.forEach(m => { %>
        <option value="<%= m.id %>"><%= m.name %></option>
      <% }) %>
    </select>
    <button class="btn">Add Outcome</button>
  </div>
</form>

<ul style="list-style:none; padding:0;">
  <% project.outcomes.forEach(o => { %>
    <li class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong><%= o.title %></strong>
          <div><%= o.description || '' %></div>
          <small>Target: <%= o.targetValue ?? '—' %> • Metric: <%= o.metricId ? metrics.find(m=>m.id===o.metricId)?.name : '—' %></small>
        </div>
        <form method="post" action="/projects/<%= project.id %>/outcomes/<%= o.id %>/delete">
          <button class="btn" style="background:#b91c1c;">Delete</button>
        </form>
      </div>
    </li>
  <% }) %>
</ul>

<hr/>

<h2>Opportunities</h2>
<form method="post" action="/projects/<%= project.id %>/opportunities" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
  <div style="display:flex; gap:.5rem;">
    <input name="title" placeholder="Opportunity title" required style="flex:2; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <select name="outcomeId" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option value="">Linked outcome (optional)</option>
      <% outcomes.forEach(o => { %>
        <option value="<%= o.id %>"><%= o.title %></option>
      <% }) %>
    </select>
  </div>
  <input name="problem" placeholder="Problem (optional)" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  <input name="evidence" placeholder="Evidence (optional)" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  <div style="display:flex; gap:.5rem;">
    <select name="confidence" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option>LOW</option><option selected>MEDIUM</option><option>HIGH</option>
    </select>
    <button class="btn">Add Opportunity</button>
  </div>
</form>

<ul style="list-style:none; padding:0;">
  <% project.opportunities.forEach(o => { %>
    <li class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong><%= o.title %></strong> <small>(Confidence: <%= o.confidence %>)</small>
          <div><small>Outcome: <%= o.outcomeId ? outcomes.find(x=>x.id===o.outcomeId)?.title : '—' %></small></div>
          <div><%= o.problem || '' %></div>
          <div><%= o.evidence || '' %></div>
          <% if (o.experiments.length) { %>
            <div style="margin-top:.5rem;">
              <em>Experiments:</em>
              <ul>
                <% o.experiments.forEach(e => { %>
                  <li>
                    <strong><%= e.hypothesis %></strong> — <small><%= e.status %></small>
                    <a href="/projects/<%= project.id %>/experiments/<%= e.id %>/edit" class="btn-outline" style="margin-left:.5rem;">Edit</a>
                    <form method="post" action="/projects/<%= project.id %>/experiments/<%= e.id %>/delete" style="display:inline;">
                      <button class="btn" style="margin-left:.5rem; background:#b91c1c;">Delete</button>
                    </form>
                  </li>
                <% }) %>
              </ul>
            </div>
          <% } %>
        </div>
        <div>
          <a class="btn-outline" href="/projects/<%= project.id %>/opportunities/<%= o.id %>/edit">Edit</a>
          <form method="post" action="/projects/<%= project.id %>/opportunities/<%= o.id %>/delete" style="display:inline;">
            <button class="btn" style="margin-left:.5rem; background:#b91c1c;">Delete</button>
          </form>
        </div>
      </div>
    </li>
  <% }) %>
</ul>

<h3>New Experiment</h3>
<form method="post" action="/projects/<%= project.id %>/experiments" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
  <div style="display:flex; gap:.5rem;">
    <select name="opportunityId" required style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option value="">Choose opportunity…</option>
      <% opportunities.forEach(op => { %>
        <option value="<%= op.id %>"><%= op.title %></option>
      <% }) %>
    </select>
    <input name="hypothesis" placeholder="Hypothesis" required style="flex:2; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  </div>
  <div style="display:flex; gap:.5rem;">
    <input name="method" placeholder="Method (optional)" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <select name="status" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <option selected>PLANNED</option><option>RUNNING</option><option>SUCCEEDED</option><option>FAILED</option>
    </select>
  </div>
  <button class="btn">Add Experiment</button>
</form>

<hr/>

<h2>Metrics</h2>
<form method="post" action="/projects/<%= project.id %>/metrics" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
  <div style="display:flex; gap:.5rem;">
    <input name="name" placeholder="Metric name (e.g., Activation Rate)" required style="flex:2; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    <input name="unit" placeholder="Unit (e.g., %)" style="width:160px; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
  </div>
  <textarea name="description" rows="2" placeholder="Description (optional)" style="padding:.5rem; border:1px solid #ccc; border-radius:8px;"></textarea>
  <button class="btn">Add Metric</button>
</form>

<% if (metrics.length) { %>
  <h3>Add Snapshot</h3>
  <form method="post" action="/projects/<%= project.id %>/metrics/snapshots" style="display:grid; gap:.5rem; max-width:680px; margin:.5rem 0 1rem;">
    <div style="display:flex; gap:.5rem;">
      <select name="metricId" required style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
        <option value="">Choose metric…</option>
        <% metrics.forEach(m => { %>
          <option value="<%= m.id %>"><%= m.name %></option>
        <% }) %>
      </select>
      <input type="number" step="0.0001" name="value" placeholder="Value" required style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    </div>
    <div style="display:flex; gap:.5rem;">
      <input type="datetime-local" name="ts" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
      <input name="note" placeholder="Note (optional)" style="flex:1; padding:.5rem; border:1px solid #ccc; border-radius:8px;">
    </div>
    <button class="btn">Add Snapshot</button>
  </form>
<% } %>

<ul style="list-style:none; padding:0;">
  <% metrics.forEach(m => { %>
    <li class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <strong><%= m.name %></strong> <small>(<%= m.unit || 'unitless' %>)</small>
          <% if (m.snapshots.length) { %>
            <div style="margin-top:.5rem;">
              <em>Snapshots:</em>
              <ul>
                <% m.snapshots.forEach(s => { %>
                  <li>
                    <small><%= new Date(s.ts).toLocaleString() %> → <%= s.value %> <%= m.unit || '' %> <%= s.note ? '— ' + s.note : '' %></small>
                    <form method="post" action="/projects/<%= project.id %>/metrics/snapshots/<%= s.id %>/delete" style="display:inline;">
                      <button class="btn-outline" style="margin-left:.5rem;">Delete</button>
                    </form>
                  </li>
                <% }) %>
              </ul>
            </div>
          <% } %>
        </div>
        <form method="post" action="/projects/<%= project.id %>/metrics/<%= m.id %>/delete">
          <button class="btn" style="background:#b91c1c;">Delete Metric</button>
        </form>
      </div>
    </li>
  <% }) %>
</ul>
